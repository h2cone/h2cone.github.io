<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>重新认识 MySQL（一） - Huangh&#39;s blog</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="索引篇。" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="重新认识 MySQL（一）" />
<meta property="og:description" content="索引篇。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://h2cone.github.io/2022/03/15/mysql-index/" />
<meta property="article:published_time" content="2022-03-15T15:48:42+08:00" />
<meta property="article:modified_time" content="2022-03-15T15:48:42+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="重新认识 MySQL（一）"/>
<meta name="twitter:description" content="索引篇。"/>
<script src="https://h2cone.github.io/js/feather.min.js"></script>
	
	
        <link href="https://h2cone.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://h2cone.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://h2cone.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css"  disabled />
	

	
	
		<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
		</script>
	
		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script>
	

	
	
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
		
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
			</script>
	
	
	

	<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script>
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://h2cone.github.io/">Huangh&#39;s blog</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/post">Posts</a>
		
		<a href="/tags">Tags</a>
		
		| <span id="dark-mode-toggle" onclick="toggleTheme()"></span>
		<script src="https://h2cone.github.io/js/themetoggle.js"></script>
		
	</nav>
</header>

<div id="search"></div>
<main>
	<article>
		<div class="title">
			<h1 class="title">重新认识 MySQL（一）</h1>
			<div class="meta">Posted on Mar 15, 2022</div>
		</div>
		

		<section class="body">
			<h2 id="概述">概述</h2>
<p>MySQL 无疑是“八股文”的重灾区之一，默认存储引擎是 InnoDB 的 MySQL 实际上是什么样子？</p>
<h3 id="mysql-架构">MySQL 架构</h3>
<p><img src="/img/mysql/mysql-architecture.png" alt="mysql-architecture"></p>
<p>这是 <a href="https://dev.mysql.com/doc/refman/8.0/en/pluggable-storage-overview.html">MySQL 架构图</a>，结合应用程序开发经验，不难看出：</p>
<ul>
<li>客户端/服务端模型。</li>
<li>MySQL 的守护进程是 mysqld。</li>
<li>MySQL 服务端向客户端提供了 <strong>SQL 接口（包括 DDL、DML、DQL、DCL）</strong>。</li>
<li>MySQL <strong>可插拔</strong>存储引擎，MySQL 8.0 默认存储引擎是 InnoDB（除非创建表时指定其它引擎）。</li>
<li>MySQL 服务端从上到下可分为三层次：服务层（SQL、解析、优化、缓存）、存储引擎、文件。</li>
<li>存储引擎隐藏了数据库文件与内存缓冲池的复杂性，向服务层提供了统一的文件读写接口？</li>
</ul>
<h3 id="innodb-架构">InnoDB 架构</h3>
<p>InnoDB 至少有以下优势：</p>
<ul>
<li>遵循 <strong>ACID 模型</strong>，事务具有提交、回滚、崩溃恢复的功能以保护用户数据。</li>
<li><strong>行级锁</strong>与<strong>一致性读</strong>提高了多用户并发访问的性能。</li>
<li>每张 InnoDB 表都有一个聚簇索引，能够最小化主键查询的 I/O 次数。</li>
<li>支持外键约束来保持数据完整性。</li>
</ul>
<p><img src="/img/innodb/innodb-architecture.png" alt="innodb-architecture"></p>
<p>这是 <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-architecture.html">InnoDB 架构图</a>，二分为<strong>在内存中的结构</strong>与<strong>在磁盘上的结构</strong>，</p>
<h3 id="sql-执行路径">SQL 执行路径</h3>
<p>一条普通的 SELECT 语句的旅程如下所示：</p>
<p><img src="/img/mysql/Figure_4-1._Execution_path_of_a_query.png" alt="Figure_4-1._Execution_path_of_a_query"></p>
<ol>
<li>
<p>客户端输入语句。</p>
</li>
<li>
<p>消息通过 TCP/IP 线路。</p>
</li>
<li>
<p>服务端判定是否命中缓存，未命中则<strong>解析语句</strong>与<strong>生成执行计划</strong>。</p>
</li>
<li>
<p>服务端调用下层函数。</p>
</li>
<li>
<p>存储引擎读写文件。</p>
</li>
</ol>
<h2 id="索引篇">索引篇</h2>
<h3 id="数据结构">数据结构</h3>
<p><a href="https://en.wikipedia.org/wiki/Database_index">索引</a>是<strong>以额外的写入与空间为代价</strong>来<strong>加速数据查找</strong>的一类<strong>数据结构</strong>的统称。索引就像图书开头名为“目录”的书页或结尾名为“索引”的书页，读者想要查看某一内容，与其从第一页开始翻阅直到遇见目标书页为止，不如先在“索引”或“目录”查找关键词得到页码，有了页码就能<strong>快速定位</strong>关键词所在的书页。虽然隐喻便于理解索引的加速作用，但说服力有限，至少定性描述解决查找问题的数据结构与算法性能：</p>
<p><img src="/img/algs4/%E7%AC%A6%E5%8F%B7%E8%A1%A8%E6%80%A7%E8%83%BD.png" alt="符号表性能"></p>
<p>上图是著名的<a href="https://algs4.cs.princeton.edu/home/">红皮书</a>对所讲述的数据结构与算法<a href="https://en.wikipedia.org/wiki/Time_complexity">时间复杂度</a>的总结，顺序查找最慢，二叉树查找最坏的情况下退化成顺序查询，而有序数组的插入操作很慢，对于查找与插入较好的权衡是 2-3 树查找（红黑树）。散列表或哈希表表现如何？取决于<a href="https://en.wikipedia.org/wiki/Hash_function">哈希函数</a>的实现，一般情况下，<a href="https://en.wikipedia.org/wiki/Hash_table#Performance">Hash Table 时间复杂度是 O(1)</a>，几乎与 N 无关。</p>
<p>数据库系统（DBMS）不仅管理内存缓冲池（Buffer Pool），而且管理数据库文件（Database File）。由于计算机系统<strong>主存（Memory）与磁盘（Disk）的速度高度不对等</strong>，开发者选择数据结构不仅考虑发生在内存的查找与插入，而且高度注意<strong>磁盘 I/O 次数</strong>或<strong>页（Page）访问次数</strong>。</p>
<p><img src="/img/db/disk-oriented_dbms.gif" alt="disk-oriented_dbms"></p>
<p><strong>页是一块连续、固定大小的数据</strong>。从关系数据库系统的角度来看，某一张表的某一行数据存在于某一页或某一些页中。关系数据库既然声称支持 SQL，那么至少满足以下查询需求：</p>
<p>FROM &amp; JOIN -&gt; WHERE -&gt; GROUP BY -&gt; HAVING -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT</p>
<p>在 WHERE 或 HAVING 处，可以是等值条件，如 =，也可以范围条件，如 &lt;、&gt;、BETWEEN &hellip; AND &hellip;；GROUP BY 隐含了是否相等的比较；ORDER BY 要求有序或排序；SELECT 列表可以包含聚合函数，如 COUNT、SUM、MIN、AVG、MAX 等。</p>
<p>不止于支持等值查询、范围查询、有序操作的高性能的磁盘友好型数据结构是什么？MySQL InnoDB 开发者选择 <a href="https://en.wikipedia.org/wiki/B%2B_tree">B+ tree</a>。</p>
<p><img src="/img/data-structure/b_tree.png" alt="b_tree"></p>
<p>B+ tree 从 <a href="https://en.wikipedia.org/wiki/B-tree">B-tree</a> 演化而来，两者都属于<strong>平衡</strong>查找树，不会出现过长的枝，结点更胖且树更矮有助于缩短搜索路径或减少搜索范围。B+ tree 叶子结点<strong>冗余</strong>存储键，叶子结点包含的键的范围如下所示：</p>
<p>[最小键或父母的较小键, 最大键或父母的较大键)</p>
<p>由于 B+ tree 叶子结点更胖且叶子结点之间相互链接组成有序链表，范围查询时定位到一个叶子结点后无需返回到父母结点，而是遍历有序链表，因此范围查找性能高于 B-tree。</p>
<p>受到 <a href="https://blog.jcole.us/2013/01/10/btree-index-structures-in-innodb/">B+Tree index structures in InnoDB</a> 的启发，确信 InnoDB 基于 B+ tree 实现索引，其结点被称之为页（Page），页包含多条记录（Record），记录由键（Key）与值（Value）组成，值的类型是元组（tuple）或指针（pointer）。除了用户插入的记录，Infimun 和 Supremun 都属于系统记录（system record），前者包含最大下界，后者包含最小上界。<strong>叶子页的记录包含行数据，非叶子页的记录包含指向其它页的指针</strong>，叶子页之间和非叶子页之间都存在链接，非叶子页为快速定位叶子页提供了导航。</p>
<p>叶子页逻辑结构：</p>
<p><img src="/img/innodb/B_Tree_Simplified_Leaf_Page.png" alt="B_Tree_Simplified_Leaf_Page"></p>
<p>非叶子页逻辑结构：</p>
<p><img src="/img/innodb/B_Tree_Simplified_Non_Leaf_Page.png" alt="B_Tree_Simplified_Non_Leaf_Page"></p>
<p>假设创建一张表并插入一些记录：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> t_btree (
  i INT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  s CHAR(<span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(i)
) ENGINE<span style="color:#f92672">=</span>InnoDB;

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t_btree (i, s) <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;A&#34;</span>), (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;B&#34;</span>), (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;C&#34;</span>);
</code></pre></div><p>这张表的索引如下所示（逻辑结构）：</p>
<p><img src="/img/innodb/B_Tree_Structure.png" alt="B_Tree_Structure"></p>
<p>不局限于二维表格，转移到索引的数据结构是解决问题的全新视角。</p>
<h3 id="索引分类">索引分类</h3>
<p>按数据结构：</p>
<p>大多数 MySQL 索引（PRIMARY KEY、UNIQUE、KEY/INDEX）都存储在 B-Trees 中。例外：空间数据类型的索引使用 R-trees；MEMORY 表也支持 Hash 索引；InnoDB 对 FULLTEXT 索引使用倒排列表。</p>
<p>按存储器：</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html">Adaptive Hash Index</a> 在内存中，<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-index-types.html">Clustered and Secondary Indexes</a> 和 <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-fulltext-index.html">InnoDB Full-Text Indexes</a> 在磁盘上。</p>
<p>按索引类（Index Class）：</p>
<p><img src="/img/innodb/Table_13.2_InnoDB_Storage_Engine_Index_Characteristics.png" alt="Table_13.2_InnoDB_Storage_Engine_Index_Characteristics"></p>
<p>按列的个数：</p>
<p>分成单列索引（column index）和复合索引（composite index），复合索引即多列索引。</p>
<h3 id="如何使用">如何使用</h3>
<h4 id="创建">创建</h4>
<p>用户要么在<a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html">创建表时创建索引</a>，要么在<a href="https://dev.mysql.com/doc/refman/8.0/en/create-index.html">创建表后创建索引</a>。一般情况下，MySQL 优化器足以<a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_selectivity">通过统计信息从用户创建的索引当中选择最优的索引</a>。</p>
<h4 id="优化">优化</h4>
<p>每张 InnoDB 表都有一个<strong>聚簇索引（clustered index）</strong>，却不一定有<strong>二级索引（secondary Index）</strong>，前者有时被称为主键索引，后者有时被称为辅助索引。<strong>聚簇索引叶子页的记录包含整行数据</strong>，<strong>二级索引叶子页的记录包含主键值</strong>。</p>
<p>假设有一张名为 tab 的表，主键（PRIMARY KEY）是 pk，唯一键（UNIQUE）是 uk，普通索引（KEY/INDEX）的列是 k，无索引的列是 col：</p>
<table>
<thead>
<tr>
<th>pk</th>
<th>uk</th>
<th>k</th>
<th>col</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>uk1</td>
<td>k1</td>
<td>col1</td>
</tr>
<tr>
<td>2</td>
<td>uk2</td>
<td>k2</td>
<td>col2</td>
</tr>
<tr>
<td>3</td>
<td>uk3</td>
<td>k3</td>
<td>col3</td>
</tr>
</tbody>
</table>
<p>表 tab 的聚簇索引叶子页们表示为:</p>
<p>(1, uk1, k1, col1) ⇆ (2, uk2, k2, col2) ⇆ (3, uk3, k3, col13)</p>
<p>表 tab 的一个二级索引叶子页们表示为：</p>
<p>(uk1, 1) ⇆ (uk2, 2) ⇆ (uk3, 3)</p>
<p>表 tab 的另一个二级索引叶子页们表示为：</p>
<p>(k1, 1) ⇆ (k2, 2) ⇆ (k3, 3)</p>
<p>下面的语句执行只在一个聚簇索引上搜索：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> tab <span style="color:#66d9ef">WHERE</span> pk <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
</code></pre></div><p>下面的语句执行依次在一个二级索引和一个聚簇索引上搜索：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> tab <span style="color:#66d9ef">WHERE</span> uk <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;uk3&#34;</span>;
</code></pre></div><p>先在 uk 的索引找到 (uk3, 3) ，得到主键值为 3，再通过该主键值在 pk 的索引找到 (3, uk3, col13)。由此看来，索引访问次数的差异决定了通过主键查询可以比通过唯一键查询或普通索引列查询更快。应用程序不总是只通过主键查询数据，假设有一张学员表：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>student<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
  <span style="color:#f92672">`</span>first_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">COLLATE</span> utf8mb4_bin <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>last_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">COLLATE</span> utf8mb4_bin <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>email<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">COLLATE</span> utf8mb4_bin <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>gender<span style="color:#f92672">`</span> tinyint unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span>,
  <span style="color:#f92672">`</span>ip_address<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">COLLATE</span> utf8mb4_bin <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> int <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span>,
  <span style="color:#f92672">`</span>created_at<span style="color:#f92672">`</span> <span style="color:#66d9ef">timestamp</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
  <span style="color:#f92672">`</span>updated_at<span style="color:#f92672">`</span> <span style="color:#66d9ef">timestamp</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB AUTO_INCREMENT<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8mb4_bin;
</code></pre></div><p>预期数据量足够大的情况下，如何创建索引以提高种一些条件查询的效率：email、level、email and level、level and email？假设 id 的索引名为 pk，若只创建普通索引：email_k，则下面的语句在 email_k 搜索命中后，仍然会在 pk 搜索：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
</code></pre></div><p>若只创建普通索引 level_k，则下面的语句在 level_k 搜索命中后，仍然会在 pk 搜索：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
</code></pre></div><p>除了聚簇索引，是否存在包含 SQL 检索到的所有列的索引？MySQL 支持<strong>复合</strong>多个普通索引，可以创建<a href="https://dev.mysql.com/doc/refman/8.0/en/multiple-column-indexes.html">多列索引</a>。如果表拥有一个多列索引，优化器可以使用索引的任何<strong>最左前缀</strong>来查找行。例如，如果在 (col1, col2, col3) 上有一个三列索引，则在 (col1)、(col1, col2) 和 (col1, col2, col3) 上有均有索引。</p>
<p>使用索引 (col1, col2, col3) 的语句们：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> tbl <span style="color:#66d9ef">WHERE</span> col1 <span style="color:#f92672">=</span> val1;
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> tbl <span style="color:#66d9ef">WHERE</span> col1 <span style="color:#f92672">=</span> val1 <span style="color:#66d9ef">AND</span> col2 <span style="color:#f92672">=</span> val2;
</code></pre></div><p>无可用索引的语句们：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> tbl <span style="color:#66d9ef">WHERE</span> col2 <span style="color:#f92672">=</span> val2;
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> tbl <span style="color:#66d9ef">WHERE</span> col2 <span style="color:#f92672">=</span> val2 <span style="color:#66d9ef">AND</span> col3 <span style="color:#f92672">=</span> val3;
</code></pre></div><p>MySQL 官方还有一个非常经典的例子，创建一个索引：INDEX name (last_name, first_name)。</p>
<p>使用索引 name 的语句们：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> student <span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Jones&#39;</span>;
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> student <span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Jones&#39;</span> <span style="color:#66d9ef">AND</span> first_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;John&#39;</span>;
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> student <span style="color:#66d9ef">WHERE</span> last_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Jones&#39;</span> <span style="color:#66d9ef">AND</span> (first_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;John&#39;</span> <span style="color:#66d9ef">OR</span> first_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Jon&#39;</span>);
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> student <span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Jones&#39;</span> <span style="color:#66d9ef">AND</span> first_name <span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;M&#39;</span> <span style="color:#66d9ef">AND</span> first_name <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#39;N&#39;</span>;
</code></pre></div><p>无法使用索引 name 的语句们：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> student <span style="color:#66d9ef">WHERE</span> first_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;John&#39;</span>;
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> student <span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Jones&#39;</span> <span style="color:#66d9ef">OR</span> first_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;John&#39;</span>;
</code></pre></div><p>覆盖了查询语句中所有列的索引被称为<a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_covering_index">覆盖索引（covering index）</a>，在中文语境，覆盖索引可以避免<strong>回表</strong>，回表指的是在一个索引上搜索完成后返回到另一个索引上搜索。如果在索引 (col1, col2, col3) 命中了 col1，那么可直接获取 col1、col2、col3 而无需继续在其它索引上搜索 col2 或 col3。</p>
<p>如果用 (email)、(level) 依次表示 email_k、level_k，那么 (email, level) 表示多个索引：(email)、(email, level)，反过来说，(level, email) 表示多个索引：(level)、(level, email)。对于优化器来说，level and email 和 email and level 等价，剩下 level 和 email 需要覆盖。</p>
<p>一般情况下，页包含的记录越短或者列长度之和越短，又或者索引占用空间越小，从磁盘加载到内存也就越快。数据类型 VARCHAR(M) 其中的 M 表示以字符为单位声明的非二进制字符串类型的列长度，例如，上文列 email 的数据类型是 varchar(50)，它表示可存储的最大字符数为 50，然而，一个字符等于多少字节则取决于<a href="https://dev.mysql.com/doc/refman/8.0/en/charset.html">字符集</a>。列长度单位是字节数，如何计算可以参考<a href="https://dev.mysql.com/doc/refman/8.0/en/storage-requirements.html">数据类型存储要求</a>。</p>
<p>既然过长字符串有可能降低查询性能，那有哪些优化方案？MySQL 支持<a href="https://dev.mysql.com/doc/refman/8.0/en/column-indexes.html#column-indexes-prefix">索引字符串前缀</a>，但是，前缀的<strong>区分度</strong>过低的话，很有可能增加<strong>扫描行数（rows examined）</strong>，在最坏的情况下（最后一个键的值才全等），不仅在二级索引上遍历许多值的前缀相等的键，而且每次都要返回到聚簇索引上进一步查找和对比才能确认是否全等；由于回表，字符串前缀索引很少成为覆盖索引。如果后缀比前缀区分度更高，可以考虑<strong>倒序排列</strong>字符串，例如先倒排存储身份证号，将来查询需要反转输入字符串：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> column_list <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id_card <span style="color:#f92672">=</span> REVERSE(<span style="color:#e6db74">&#39;input_id_card&#39;</span>);
</code></pre></div><p>如果用 count(distinct col) 表示 col 的<strong>基数</strong>，那么 col 的区分度计算类似于：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">count</span>(<span style="color:#66d9ef">distinct</span> col) <span style="color:#f92672">/</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> t;
</code></pre></div><p>另一种方案是新增相应的哈希列，例如增加整数类型的列：身份证号的 <a href="https://dev.mysql.com/doc/refman/8.0/en/mathematical-functions.html#function_crc32">CRC32</a>，查询需要调用哈希函数，且需要组合原列处理可能发生碰撞的场景：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> column_list <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id_card_crc <span style="color:#f92672">=</span> CRC32(<span style="color:#e6db74">&#39;input_id_card&#39;</span>) <span style="color:#66d9ef">and</span> id_card <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;input_id_card&#39;</span>;
</code></pre></div><p>简单总结一下四种索引字符串方式的优缺点：</p>
<table>
<thead>
<tr>
<th>索引字符串</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>整串</td>
<td>扫描行数或回表次数较少。</td>
<td>空间占用较大。</td>
</tr>
<tr>
<td>前缀</td>
<td>空间占用较小。</td>
<td>可能增加扫描行数或回表次数。</td>
</tr>
<tr>
<td>倒序</td>
<td>无需新增列。</td>
<td>不支持范围查询；空间占用较大。</td>
</tr>
<tr>
<td>哈希</td>
<td>扫描行数或回表次数较少。</td>
<td>不支持范围查询；需要新增列。</td>
</tr>
</tbody>
</table>
<p>有时，业务系统要求数据不重复，唯一索引实现了数据库层的唯一性约束。与普通索引相比，<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-change-buffer.html">Change Buffer</a> 无法缓冲对唯一索引的插入，除非设置 unique_checks = 0，因为唯一性检查要求必须将页从磁盘读入内存才能判断某值是否已存在。</p>
<p>INSERT、UPDATE 和 DELETE 都需要更改所有索引，出于这个原因，这些<strong>变更</strong>通常会被<strong>缓冲</strong>。页在<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html">缓冲池</a>中被更改，而不立即<strong>刷入</strong>磁盘。删除记录时，会设置一个标志，因此不会立即在磁盘上删除记录。稍后，变更将由 InnoDB 后台线程刷入磁盘。已在内存中更改但尚未刷入磁盘的页被称为<strong>脏页</strong>，数据变更缓冲区被称为 Change Buffer。</p>
<p>普通索引组合 Change Buffer 是一种不错的优化：</p>
<ul>
<li>一张页可以在内存中多次更改，并且只能刷入磁盘一次。</li>
<li>因为脏页们一起刷入磁盘，所以 I/O 次数比较少。</li>
</ul>
<h2 id="做正确的事情">做正确的事情</h2>
<p>优化具体查询语句的第一步不应直接套用上文所说的方式，而应该先<a href="https://dev.mysql.com/doc/refman/8.0/en/using-explain.html">使用 EXPLAIN</a>，特别是理解 <a href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html">EXPLAIN 输出信息</a>，比如是否使用索引、使用哪些索引、访问类型、预计扫描行数等。</p>
<p>当表 student 只有聚簇索引：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> <span style="color:#66d9ef">index</span> <span style="color:#66d9ef">from</span> student;
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Table</span>   <span style="color:#f92672">|</span> Non_unique <span style="color:#f92672">|</span> Key_name <span style="color:#f92672">|</span> Seq_in_index <span style="color:#f92672">|</span> <span style="color:#66d9ef">Column_name</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Collation</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Cardinality</span> <span style="color:#f92672">|</span> Sub_part <span style="color:#f92672">|</span> Packed <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> Index_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">Comment</span> <span style="color:#f92672">|</span> Index_comment <span style="color:#f92672">|</span> Visible <span style="color:#f92672">|</span> Expression <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>  <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> id          <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">204700</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">169951</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span>  <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>     <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">8</span>       <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>  <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span>   <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ALL</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>          <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">10</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">where</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>  <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span>   <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ALL</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>          <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">10</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">where</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span> <span style="color:#66d9ef">and</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>  <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span>   <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ALL</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>          <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">where</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span> <span style="color:#66d9ef">and</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>  <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span>   <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ALL</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>          <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">where</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>当表 student 的二级索引只有 (email) 和 (level)：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> <span style="color:#66d9ef">index</span> <span style="color:#66d9ef">from</span> student;
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Table</span>   <span style="color:#f92672">|</span> Non_unique <span style="color:#f92672">|</span> Key_name <span style="color:#f92672">|</span> Seq_in_index <span style="color:#f92672">|</span> <span style="color:#66d9ef">Column_name</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Collation</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Cardinality</span> <span style="color:#f92672">|</span> Sub_part <span style="color:#f92672">|</span> Packed <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> Index_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">Comment</span> <span style="color:#f92672">|</span> Index_comment <span style="color:#f92672">|</span> Visible <span style="color:#f92672">|</span> Expression <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>  <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> id          <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">204700</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> email_k  <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> email       <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">204700</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> level_k  <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">level</span>       <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">3</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>     <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_k       <span style="color:#f92672">|</span> email_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">202</span>     <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>     <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> level_k       <span style="color:#f92672">|</span> level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">4</span>       <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span> <span style="color:#ae81ff">2936</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span> <span style="color:#66d9ef">and</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------+---------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys   <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>     <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------+---------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_k,level_k <span style="color:#f92672">|</span> email_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">202</span>     <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">5</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">where</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------+---------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span> <span style="color:#66d9ef">and</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------+---------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys   <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>     <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------+---------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_k,level_k <span style="color:#f92672">|</span> email_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">202</span>     <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">5</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">where</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------+---------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>当表 student 的二级索引只有 (email, level)：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> <span style="color:#66d9ef">index</span> <span style="color:#66d9ef">from</span> student;
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+---------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Table</span>   <span style="color:#f92672">|</span> Non_unique <span style="color:#f92672">|</span> Key_name      <span style="color:#f92672">|</span> Seq_in_index <span style="color:#f92672">|</span> <span style="color:#66d9ef">Column_name</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Collation</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Cardinality</span> <span style="color:#f92672">|</span> Sub_part <span style="color:#f92672">|</span> Packed <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> Index_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">Comment</span> <span style="color:#f92672">|</span> Index_comment <span style="color:#f92672">|</span> Visible <span style="color:#f92672">|</span> Expression <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+---------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>       <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> id          <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">204700</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> email       <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span>            <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">level</span>       <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+---------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">3</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>           <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">202</span>     <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">index</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+-------+---------------+---------------+---------+------+--------+----------+--------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span>  <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>           <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span>   <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra                    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+-------+---------------+---------------+---------+------+--------+----------+--------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">index</span> <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">206</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">10</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">where</span>; <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">index</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+-------+---------------+---------------+---------+------+--------+----------+--------------------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span> <span style="color:#66d9ef">and</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>           <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>         <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">206</span>     <span style="color:#f92672">|</span> const,const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span> <span style="color:#66d9ef">and</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>           <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>         <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">206</span>     <span style="color:#f92672">|</span> const,const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>当表 student 的二级索引只有 (email, level) 和 (level)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> <span style="color:#66d9ef">index</span> <span style="color:#66d9ef">from</span> student;
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+---------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Table</span>   <span style="color:#f92672">|</span> Non_unique <span style="color:#f92672">|</span> Key_name      <span style="color:#f92672">|</span> Seq_in_index <span style="color:#f92672">|</span> <span style="color:#66d9ef">Column_name</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Collation</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Cardinality</span> <span style="color:#f92672">|</span> Sub_part <span style="color:#f92672">|</span> Packed <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> Index_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">Comment</span> <span style="color:#f92672">|</span> Index_comment <span style="color:#f92672">|</span> Visible <span style="color:#f92672">|</span> Expression <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+---------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>       <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> id          <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">204700</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> email       <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span>            <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">level</span>       <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>      <span style="color:#ae81ff">298708</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> student <span style="color:#f92672">|</span>          <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> level_k       <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">level</span>       <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+------------+---------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>           <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">202</span>     <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Using</span> <span style="color:#66d9ef">index</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">02</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> email, <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys         <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>     <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_level_k,level_k <span style="color:#f92672">|</span> level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">4</span>       <span style="color:#f92672">|</span> const <span style="color:#f92672">|</span> <span style="color:#ae81ff">2936</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------+---------+-------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span> <span style="color:#66d9ef">and</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys         <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>           <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>         <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_level_k,level_k <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">206</span>     <span style="color:#f92672">|</span> const,const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">level</span><span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">59</span> <span style="color:#66d9ef">and</span> email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sharryms@edublogs.org&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> select_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">table</span>   <span style="color:#f92672">|</span> partitions <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">|</span> possible_keys         <span style="color:#f92672">|</span> <span style="color:#66d9ef">key</span>           <span style="color:#f92672">|</span> key_len <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>         <span style="color:#f92672">|</span> <span style="color:#66d9ef">rows</span> <span style="color:#f92672">|</span> filtered <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">SIMPLE</span>      <span style="color:#f92672">|</span> student <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">ref</span>  <span style="color:#f92672">|</span> email_level_k,level_k <span style="color:#f92672">|</span> email_level_k <span style="color:#f92672">|</span> <span style="color:#ae81ff">206</span>     <span style="color:#f92672">|</span> const,const <span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------------+---------+------------+------+-----------------------+---------------+---------+-------------+------+----------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><blockquote>
<p>本文首发于 https://h2cone.github.io/</p>
</blockquote>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-indexes.html">How MySQL Uses Indexes</a></li>
<li><a href="https://github.com/jeremycole/innodb_diagrams">Diagrams for InnoDB data structures and behaviors</a></li>
</ul>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/mysql">mysql</a></li>
					
					<li><a href="/tags/innodb">innodb</a></li>
					
					<li><a href="/tags/index">index</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/h2cone" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2024  © Huangh&#39;s blog |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
  feather.replace()
</script></div>
    </body>
</html>
